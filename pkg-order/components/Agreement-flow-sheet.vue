<template>
  <view v-if="visible" class="afs-mask" @touchmove.stop.prevent>
    <view class="afs-panel">
      <!-- 顶部步骤 -->
      <view class="afs-steps">
        <text :class="['s', step>=1 && 'on']">1.《租赁服务协议》</text>
        <text :class="['s', step>=2 && 'on']">2.《不计免赔说明》</text>
        <text :class="['s', step>=3 && 'on']">3.签名</text>
        <text class="x" @tap="$emit('close')">✕</text>
      </view>

      <!-- 内容：步骤1/2 -->
      <scroll-view
        v-if="step<=2"
        :key="'sv-'+step"        
        class="afs-body"
        scroll-y
        :scroll-top="scrollTop"
        @scroll="onScroll"
        @scrolltolower="onToLower"
        lower-threshold="30"
      >
        <view class="doc">
          <slot v-if="false" />
          <view v-if="step===1">
            <text class="h1">嗒嗒用户服务协议</text>
            <text class="p">
嗒嗒用户服务协议

特别声明
嗒嗒用车互联网汽车租赁平台是由福建省嗒嗒用车科技有限公司负责运营。此协议是用户与嗒嗒用车之间关于用户使用嗒嗒用车互联网汽车租赁平台服务所签订的协议。 
定义
「嗒嗒用车」是指福建省嗒嗒用车科技有限公司创建的发布新能源小客车租赁信息、用户获取新能源小客车租赁信息的移动互联网技术服务平台。
「用户」是指嗒嗒用车服务的使用人。
「付费」指用户支付的所有款项，包括里程费，时长费以及服务条款中规定的其他相关费用。
「授权驾驶人」指嗒嗒用车注册用户本人，年满 18 周岁以上，并具有有效驾驶证件。
「使用期间」指从用户确定用车时间到用户将车辆归还至指定车辆还车地点、并按嗒嗒用车要求将车停放妥当并确认还车的期间。
「预定时间」是指用户与嗒嗒用车预先约定的取车时间。
「车辆」指用户预定的嗒嗒用车新能源电动汽车或嗒嗒用车可能提供的任何替换车辆。
「车辆状态」指嗒嗒用车车辆外观、市场价格、组件、配件、系统情况，车辆内外清洁程度等与车辆工作状态相关的情况。
嗒嗒用车在此提醒您认真阅读本协议，充分理解所有条款，特别是免除或限制嗒嗒用车责任的免责条款及对您的权利限制的条款，并选择接受或不接受本协议。除非您接受协议条款，否则您无权使用本协议所涉及的车辆和相关服务。
申明
您确认，在您完成「嗒嗒用车」用户注册之前，已充分阅读、理解并接受本条款的全部内容，注册成功，即表示您同意遵循本条款之所有约定。本协议在您接受注册时生效，将成为您和嗒嗒用车之间具有法律意义的文件，您和嗒嗒用车将同时受到本协议条款的约束。在您注册成功后， 嗒嗒用车将分配给您一个会员账号，您将自行设置密码。此外，该账号和密码由您负责保管；您应当对通过您的会员账号进行的所有活动和事件承担法律责任。
您同意，本公司有权随时对本条款内容进行单方面的变更，并在嗒嗒用车网站或公众号以公告的方式予以公布，无需另行单独通知您；若您在本条款内容公告变更后继续使用本服务，表示您已充分阅读、理解并接受修改后的条款内容，也将遵循修改后的条款内容使用本服务；若您不同意修改后的条款内容，您应停止使用本服务。
您声明，您同意接受本条款并注册成为嗒嗒用车会员。您是具有法律规定的享有完全民事权利能力和民事行为能力，且能够独立承担民事责任的自然人。不具备前述条件的，请您立即停止注册或使用本服务。
注册资格
（一）凡年龄在18周岁（含）以上、持有中华人民共和国有效身份证件（二代身份证、港澳居民来往内地通行证、大陆通行证、护照（限港澳台人士）和中华人民共和国有效驾驶执照（准驾车型为C1或C2（含）以上）可注册。外籍人士暂无法申请。
（二）如果用户的驾照在任何时间被吊销、没收、失效或其状态发生变化，会员必须立即通知嗒嗒用车，且在此期间会员不得使用或预订任何嗒嗒用车服务，否则由此产生的后果／责任均由用户自行承担。
（三）嗒嗒账号的所有权归嗒嗒用车科技有限公司，客户必须使用本人的有效信息完成注册申请手续后，才可获得嗒嗒用车账号的使用权。用户应提供及时、详尽及准确的个人资料，并不断更新注册资料，符合及时、详尽）、准确的要求。输入的资料将作为注册资料由嗒嗒用车负责保存。同时，嗒嗒用车有权就用户所提交资料与信息，通过第三方平台，就其真实性、可靠性及信用等级进行评估。
（四）如果因账户注册信息不真实而引起的一切问题及其产生的后果，嗒嗒用车不负任何责任，嗒嗒用车有权对会员账号进行停封。如对嗒嗒用车造成损失，嗒嗒用车有权追究用户责任及索赔损失。
（五）用户不得将其账号、密码转让或出借予他人使用。借用人和使用人都要承担连带法律责任，嗒嗒用车不承担任何责任。借用账号给他人使用的，嗒嗒用车将提交相关证据至执法部门依法给予罚款，严重者会被吊销驾照。如用户发现其账号遭他人非法使用应立即通知嗒嗒用车。因黑客行为或会员个人的保管疏忽导致账号、密码遭他人非法使用，嗒嗒用车将不承担任何责任。
用户权利及义务
（一）用户享有使用嗒嗒用车产品和服务的权益。
（二）用户使用嗒嗒用车服务期间，享有车辆的使用权，用户承诺其持有中国大陆交管部门核发的并按要求审验的《中华人民共和国机动车驾驶证》。
（三）用户必须如实告知或填写相关信息（包括但不限于身份证件、联系方式等），保证相关证件和信息真实有效，并保证同一证件只允许关联一个账号信息，并且使用车辆期间会员信息所载明的联系方式有效。若出现注册人与用车人信息不对称，则由此产生的后果／责任均由注册人自行承担。
（四）用户自行承担车辆使用中产生的停车费和过路过桥等费用（包含但不限于以上自付费项目或因客户原因而产生的费用），用户需自行负责车上人员及财产的安全。
（五）会员在使用嗒嗒用车服务时应当严格遵守道路交通规则，不得酒后驾驶，并独立承担因交通事故产生的相关责任。
（六）如车辆出现故障或异常，用户应立即通知嗒嗒用车，告知地点后等待嗒嗒用车维修人员，也可将车辆开到嗒嗒用车指定的地点修理。
（七）车辆只能作为自己租赁车辆使用，用户不得将车辆用于营利性运营、竞赛、抵押、测试、实验、教练等活动；不得将车辆用于承载有毒有害及违禁物品；不得将车辆用于从事违法、违规活动。用户不得有转租、转借、抵押、倒卖或其他任何损害车辆所有权和使用权的行为。
（八）用户在使用车辆期间，应保持车辆外观、内饰的整洁、完好。此外，车内禁止携带宠物、海鲜、食醋等会污损内饰及异味较大的物品。在用车期间如产生污损或异味，用户需承担车辆清洁服务费用或其他责任。
（九）用户还车后由于用户个人原因致使车辆牌照、证件、车内清洁布等车内物品丢失，除支付补办相关物品的全部费用外，还应当支付补办相关物品期间给嗒嗒用车造成的营业损失费用，如无故不承担相关费用，相应法律责任由用户承担。
（十）由于因用户自身原因（如：酒驾、误操作、保管不当等）对车辆造成损失，应由用户承担相应及由此带来的一切损失，如无故不承担相关费用，相应法律责任由用户承担；
（十一）用户在使用嗒嗒用车服务期间，取还车时，需按嗒嗒用车图片所示要求拍照，取还车未拍照或未按要求拍照，后果由用户自行承担。
用户违约
（一）提供虚假信息，或盗用他人信息的。
（二）将车辆提供给任何非授权驾驶人驾驶。
（三）任何服用酒精、麻醉品或药物的驾驶人员，无论其是否在医生的指导下使用上述物品。
（四）未按约定使用车辆的。
（五）转卖、抵押、典当、转借、转租或确有证据证明可能存在上述情况的。
（六）不按协议约定交纳租金及各项费用、使用租赁车辆、保管租赁车辆、归还租赁车辆的。
（七）用户利用租赁车辆从事违法犯罪活动的。
（八）擅自改装、拆除、更换、增设车内配备的任何物品。
（九）利用任何方式方法危害「嗒嗒用车」平台安全的。
（十）利用「嗒嗒用车」或其提供的车辆，损害任何第三人合法权益的。
（十一）将车辆行驶到任何没有铺设路面的土路上行驶或越野行驶，「嗒嗒用车」以书面形式批准的除外。
（十二）承载超出车辆核定限乘人数以外的乘客。
（十三）恶意拆除车内配备的任何物品。
（十四）恶意诋毁「嗒嗒用车」的（包括在「嗒嗒用车」平台，以及在其他任何地方）；
（十五）含有法律、行政法规禁止的其他内容。
（十六）嗒嗒用车区域运营车辆只能在该区域行驶，如泉州市运营车辆只能在泉州运营。若用户将车辆行驶至区域外，所造成的损失将由用户承担。车辆禁止行驶及停放到信号弱的场所（如；山区、海边、地下室等）若用户将车辆行驶至信号弱区域所造成的损失将由用户承担。
（十七）用户因为违法违规使用车辆导致车辆被扣押或不能上路，停运之日起需向嗒嗒用车官方账户缴纳日停运损失费。
（十八）用户不得用租赁车辆进行违法活动，不得参加各类竞赛及做测试使用，不得进行营利性质的运输，不得运送易燃、易爆、易腐蚀品，不得在损坏或非正式路面上行驶，不得将承租车辆驶入高速路段，不得驶出租赁起始地所在地级市范围，凡因上述原因造成车辆损坏、车辆事故、人身伤亡或公安部门的扣车、对车主罚款、拖车等发生的一切费用和损失均由用户承担。
（十九）使用车辆还车时未关车辆大灯造成蓄电池耗电，甚至损坏时，取违约费用5元起（蓄电池若损坏则罚款价格参照4S店定损单）；
（二十）使用车辆还车时未关车门取违约费用5元起，未关车窗收取违约费用10元起（若因此造成车辆被破坏、被盗，用户需承担全部责任）；
（二十一）使用车辆还车时未熄火，取违约费用20元起；
（二十二）使用车辆时，因为人为造成车辆内外污垢或异味难除时，收取相应车辆清洗费用20 - 100元起；
（二十三）使用车辆时，影响道路正常通行者，收取违约费用20 - 2000元；
（二十四）使用车辆时，因为人为造成车辆钥匙丢失，收取钥匙丢失违约费用100元；
（二十五）使用车辆时，因为人为破坏车辆车贴，收取车贴违约费用200元；
（二十六）用户禁止租用本公司车辆进行：恶意聚众上访、纠集上访；非法垄断和强占客运路线，暴力抢客源，经常殴打、谩骂驾乘人员和乘客，打砸损毁交通工具的；在高速、普通公路服务区以及公交线路扒窃、抢劫乘客，被发现后实施威胁、殴打、伤害等手段的；私设卡口，以各种名义向过往、停泊的交通工作收取保护费的；画地为牢，强占或非法经营码头、货场，强行提供服务的等涉及黑恶行为。
（二十七）用户具有未结款项或未处理的违章、事故、出险等事项，经确认用户为责任人，经通知后用户拒不按照约定及时处理的，因此造成的诉讼费、律师费、公证费、鉴定费等维权费用需由用户承担。
（二十八）若由用户自身原因造成的拖车，拖车费用则由用户自行承担，拖车费用起步价为150元，超出10公里每公里增加10元，该笔费用将由“嗒嗒用车”平台录入到订单之中。
 
用户若出现上述违约责任情形，将承担因此而造成的全部法律责任和经济赔偿责任，并无权通过保险获得任何可能的补偿。「嗒嗒用车」有权从用户支付的押金中直接进行抵扣，押金全部抵扣后不足以弥补「嗒嗒用车」的经济损失的，「嗒嗒用车」依然有权要求用户承担赔偿责任，用户应在收到「嗒嗒用车」通知后当日立即支付相关费用。
「嗒嗒用车」可在不向用户发出通知的情况下，终止其使用车辆的权利和用户资格。「嗒嗒用车」保留法律规定的权利，包括但不限于不经过法律程序向用户发出通知而扣押车辆，用户有义务支付所有「嗒嗒用车」将车辆追回所发生的费用。
在用户不按照嗒嗒用车要求归还车辆时，「嗒嗒用车」有权利用备用的车辆钥匙将租赁车辆取回；对于车辆中的物品嗒嗒用车有权留置或返还，由此而造成用户损失的，嗒嗒用车不承担任何赔偿责任。如果用户在使用权利终止后继续使用车辆，嗒嗒用车有权通知公安机关车辆被盗并配合公安机关追回车辆。
计费规则和收费项目
实际费用可能因优惠活动、车型不同而调整，最终价格以嗒嗒用车APP结算界面为标准。
.账户余额
嗒嗒用车APP中支持个人账户余额充值，充值方式为用户通过嗒嗒用车认可的在线支付渠道（支付宝、微信）向嗒嗒用车平台充值。当用户为个人账户余额充值时，该账户可用余额不支持退还，请理性充值。在「充值返利」优惠活动中返利的余额以及通过活动获得的余额均不支持退还，禁止以任何方式套现。
.押金
（1）用户可使用嗒嗒用车平台认可的在线支付渠道支付押金，押金金额以用户申请支付押金时嗒嗒用车平台提示的金额为准。嗒嗒用车有权根据用户使用车辆的具体情况调整押金标准，用户应根据嗒嗒用车平台的提示补足押金，否则将无法使用车辆。
（2）押金不等同于用户个人账户的可用余额，不具备订单支付功能，用车订单产生的费用须另行支付。
 （3）租车押金在用户最末次订单待查违章结束后（订单待查违章时间为15—20个工作日），如用户无违章扣款、无逾期未支付的费用或其他违约行为可申请退还，该押金将退还原支付账户（即支付租车押金时使用的账户），如遇特殊情况无法退还原账户的，将退还至用户提供的其他账户，退还时间为自申请之日起1—7个工作日，如遇节假日等特殊情况时间顺延。押金存入“嗒嗒用车”平台中产生的孳息归“嗒嗒用车”所有，押金退还为无息退还。
（4）用户账户有效期间，若用户存在逾期未缴纳租金、服务费、违章且未缴纳相关罚款、违约金，或违反本协议项下任何义务等行为，“嗒嗒用车”有权根据本协议相关规定按以下顺序冻结或扣除租车押金、申请支付宝代扣或刷取的预授权，抵扣包括但不限于本协议项下已经发生且逾期仍未支付的相关费用，且抵扣顺序如下：①租金、其他服务费等订单费用；②逾期未支付订单费用；③逾期处理违章违约金；④其他违约金；⑤车辆损失、损坏（包括存在破损、剐蹭，内外机件、部件、饰件、设备存在损坏、缺失、脏污，车辆无法正常启动等情形）等产生的维修费用；⑥其他应付费用；⑦给“嗒嗒用车”和/或第三方主体造成的其他所有损失，不足部分用户应根据“嗒嗒用车”要求及时补足。在用户租车押金不足本协议规定的情况下，“嗒嗒用车”有权拒绝提供租车服务，待用户补足相应押金数额后方可继续用车。
    
.预授权（芝麻信用免押）
（1）用户使用车辆前应向“ 嗒嗒用车 ”支付租车押金，用户本人“芝麻信用”通过认证，享受免押金待遇。
（2）当车辆发生损坏、违章以及发生行政处罚而产生费用后，用户不按约定承担相应责任，“嗒嗒用车”有权从租车押金中直接抵扣相应费用，抵扣不足部分，“嗒嗒用车”有权继续向用户追缴。
（3）用户不再使用“嗒嗒用车”平台租用车辆时：芝麻信用免押金的用户，可向“嗒嗒用车”申请解除免押授权，在最后一个订单结束后的第45个自然日起，可以在APP中点击申请解除授权，“嗒嗒用车”将在确认用户所有违章均已处理且所有违约及赔偿责任均已承担后的1个工作日内，为用户解除免押授权。
（4）芝麻信用分≥650分，身份证和驾驶证审核通过，无不良用车记录，即可在APP操作申请免押金。免押金操作方法：前往「个人中心」-「我的押金」-「芝麻免押」-「同意开启」申请“嗒嗒用车”免押金用车。
（5）在授权275个自然日之后，用户需在APP重新进行免押授权操作。重新授权操作步骤：结清所有未结算的费用—APP取消授权—再次同意开启免押授权。重新进行免押授权前，用户请确保所有费用已结清，否则无法重新开启。用户不再用车，在超过最后1笔订单的30个自然日后：若用户已结清费用，“ 嗒嗒用车 ”将为用户取消免押授权；若用户存在未结算费用的，经通知后，用户仍未按照约定及时支付相应费用且用户确认相关费用金额，“ 嗒嗒用车 ”有权通过支付宝信用代扣服务相应扣除，并为用户取消免押授权。
.不计免赔
在使用车辆过程中，因用户自身原因，对“嗒嗒用车”车辆造成损伤，用户本应承担对“嗒嗒用车”的赔偿费用；购买不计免赔服务后，在一定额度范围内，对用户驾龄小于2年情形的，由用户承担该赔偿费用的30%；对用户驾龄大于等于2年情形的，用户需承担该赔偿费用的15%；超出前述额度部分的，用户需自行承担赔偿费用。
不计免赔服务不等于保险，保障范围不包括保险。若车辆出现事故，动用到保险，客户需缴纳次年保险递增费用1000元/次（费用将记录在该客户APP订单中）。
注：如因不购买不计免赔服务出事故者，需承担车辆的全部损失费用（包括但不限于车辆维修费、停运损失费等）。
不计免赔服务保障范围：
.用户在车辆使用期间发生事故，因此导致车辆无法上线运营时，用户本需缴纳的150元/天的车辆停运损失费，在1000元以内可抵扣。超出1000元，所产生的停运费用，客户按实际停运天数赔偿，即150元/天。
.在使用车辆过程中，因用户自身原因，对“嗒嗒用车”车辆造成损伤，用户本应承担对“嗒嗒用车”的赔偿费用；购买不计免赔服务后，在一定额度范围内，对用户驾龄小于2年情形的，由用户承担该赔偿费用的30%；对用户驾龄大于等于2年情形的，用户需承担该赔偿费用的15%；超出前述额度部分的，用户需自行承担赔偿费用。
以下情况，不计免赔服务无法保障：
.因用户自身原因，对车辆造成损伤需要维修，用户本应承担对“嗒嗒用车”的赔偿费用；购买不计免赔服务后，在一定额度范围内，对用户驾龄小于2年情形的，由用户承担该赔偿费用的30%；对用户驾龄大于等于2年情形的，用户需承担该赔偿费用的15%；超出前述额度部分，用户需自行承担赔偿费用。（包括但不限于由此引起的车辆停运损失费）；
.车辆轮胎出现破损漏气等问题，用户未等修复，强行继续行驶，而导致轮胎报废或轮毂损坏的费用；
.车辆破损、变形、报废部分，涉及需要重新更换配件的费用；
.车内配套物品，用户损坏或丢失应按原价赔偿；
.保险理赔范围外的（包括但不限于酒驾、逃逸等）和因用户原因造成无法申报保险的；
.注：用户在车辆使用期间发生事故，如用户未能立即向“嗒嗒用车”报告事故及配合事故调查、解决工作，则购买的不计免赔服务失效，会员应承担全部损失责任和费用。
其他收费：
.如有车辆遇事故，用户须第一时间联系客服电话【400-6666-589】获取保险电话（若客服联系不上，可直接致电110或122报警。）如果没有当场报险，用户需承担全部责任及其他维修费用。
.不计免赔服务的免赔范围不包括保险。若车辆事故动用保险，客户必须缴纳次年保险递增费用1000元/次（费用将记录在该客户APP订单中）。
.如果不购买不计免赔服务出事故者，需承担车辆的全部损失费用；
.停运损失费以及保险理赔范围外的（如酒驾、逃逸等）和因客户原因造成无法申报保险的不包含在内。
.若用户在使用车辆时造成车内存在明显垃圾或异味，嗒嗒用车有权向对方收取30-200元清洁服务费。
.违规费用：预订用户将车辆交予非授权驾驶人驾驶，将被收取1000元违约金。
.用户未将汽车归还到指定还车网点，将被收取送车服务费用100元起，预约异地还车服务的除外。
.由于用户在车辆熄火时未关闭灯光，收音机等耗电部件，以致车辆电量耗尽无法再次正常行驶，嗒嗒用车将为车辆实行有偿紧急抢救。用户将被收取20元-100元的蓄电池抢救费，以及蓄电池损耗费50元。
.用户还车后未检查车辆电源、车门、车窗是否关闭，如未造成车辆严重后果的将被收取违约费用10元-100元，如造成车辆丢失，用户承担全部责任。
.用户未遵守交通法规将车辆停放在交通要道且私自离开（包含车辆故障等情况）造成交通拥堵或者其他影响道路正常通行的后果，用户需承担违规所造成的全部经济及法律责任，同时我司将视违规情况轻重收取300元-1000元罚款。
整备服务费：
.如有时指会员使用分时租赁、日租、月租产品时提供的整备服务所收取的费用。
包含用车期间轮胎单独损坏，免于承担轮胎补胎加气（不含现场救援费用），但不免除轮胎损坏后继续行驶造成的其他车辆损失。另外，不包含因用户原因造成轮胎损坏而产生的事故责任。
包含车内垃圾遗留、车身外观污渍时免于承担清洁费用。
取车、还车说明
取车说明：
.当您使用「分时」服务时，在嗒嗒用车APP下单后，15分钟内免费取消订单。超过15分钟或15分钟内进行「开门」操作订单便会按下单时间开始计费。所以您在用车前务必检查车辆是否正常，若发现故障问题，请第一时间联系到嗒嗒用车客服并说明故障情况。当您使用各类优惠套餐时，套餐时间一旦开始便无法取消订单，不支持退款，不支持使用优惠券，不支持更换套餐。
.取车时，用户应当确认车辆及附属品的实际状况，如有疑问请拍照车辆车牌和输入文字发送至嗒嗒用车微信公众号。如取车时未及时上报车辆情况而导致后续车辆损失追责的，用户应当承担相应责任。
.嗒嗒用车取车网点均是付费合作网点，用户取车遇到收费，请提前联系客服处理，擅自缴纳停车费的，一律不予退款。
还车说明：
.用车时，应注意北汽EC系列、江淮iev4车型、奇瑞EQ1车型续航里程必须保证高于30KM、帝豪EV系列和江淮iev7S车型续航里程必须保证高于50KM，当北汽EC系列、江淮iev4车型、奇瑞EQ1车型续航里程还车续航里程不足30km时，帝豪EV系列和江淮iev7S车型续航里程不足50km时，将收取200元/次电池损耗费。或因车辆电量不足，而产生的拖车费用，用户需自行承担。
.还车时，用户应将车辆开至嗒嗒用车指定服务网点位置，还车时间以用户实际操作完成还车流程的时间为准，确认所有订单完成后终止合同。
.车辆，连同其钥匙（如：北汽EC系列、江淮iEV6e）和所有的附属物品，包括行驶本，清洁布等）必须一并归还，并且要保持和使用开始前一致的状况，如发生丢失或损坏需照价赔偿相应产生的停运损失费及其他费用需一并赔偿。
.用户应在归还车辆时，确保车内无任何个人财物。如还车时，有任何用户的个人财物落在车中，所产生的相应责任由用户个人承担， 嗒嗒用车不承担任何责任。
未按约定还车说明：
.用户结束订单时，应将车辆归还至嗒嗒用车指定服务网点位置，并确认车辆车灯、门窗关闭，查看无误后在APP操作还车。
.如用户还车时，未将车辆停放至停车位，由此给嗒嗒用车造成的一切损失由用户承担，同时嗒嗒用车有权追究用户的法律责任，并有权取消违约用户的资质。
.用户归还车辆时车内未保持清洁，嗒嗒用车有权收取清洁服务费10-100元；若车身严重肮脏（如泥巴等）需要进行专业清洗的按实际产生费用收取费用。
.还车时，用户应将车辆开至嗒嗒用车指定服务网点位置，未按指定服务网点还车产生的拖车费及调度费由用户承担。
 
 
保险、事故与损失赔偿
声明：
.”嗒嗒用车“平台上运营的车辆，皆已投保了交通责任强制险未投保商业险责任险。
.用户在车辆使用期间发生任何事故，无论所处环境或严重程度如何，应立即联系”嗒嗒用车“客服人员，对于在汽车使用期间发生的强制保险理赔的调查和解决，用户有责任全力配合“嗒嗒用车”或其保险公司的工作。如用户未能立即报告事故和配合事故调查，解决工作，则购买的不计免赔服务失效，会员应承担“嗒嗒用车”平台全部损失的责任和费用。
.若为强制险保险责任以外的原因造成的事故损失以及强制险保险不能赔偿的事故损失，由用户全额承担。
.本协议将据平台和市场价格更新。“嗒嗒用车”会对不计免赔服务、赔偿收费标准、保险理赔方式进行动态调整，具体内容详情以用户下单时APP展示的协议为准
损失赔偿：
.用户在使用车辆期间，发生事故，需动用到保险赔付的，用户需承担30%的车辆损失折旧费，以及1000元的保险递增费。
.事故损失金额以保险公司定损单或4S店修理清单为准。小额损失可按简易流程定损，具体定损标准为：
.外观：外观覆盖件为前保险杠、后保险杠、车门、发动机盖、后备厢盖各为一个板块，刮擦定损为每个板块为400元。
.钣金：如外观覆盖件需钣金修复的，按每平方米400元计价。
.轮胎：如轮胎破损严重做报废处理的，按单个400元的全新购置费用计价。
.轮毂：如果轮毂破损情况严重，如变形、裂缝。按一套轮胎轮毂800元计价。
.脚垫：前座每块50元/块，后座80元/块，后备箱垫80元/块。
.清洁费：因人为造成车辆内外污垢涂抹或异味难除，将收取相应车辆清洗费用。
违章及代办说明：
.用户使用服务期内的违章及相关费用等责任由用户自行承担，“嗒嗒用车”将短信或电话通知用户使用服务期内的车辆违章，用户也可在APP的违章查询功能进行查询。用户接到违章通知起的7天内，联系嗒嗒用车微信公众号客服，咨询违章车辆行驶证是否出借，再携带身份证到嗒嗒用车办事处录入违章信息，然后携带“嗒嗒用车”平台提供的车辆行驶证原件及委托书前往交警队处理，处理后将行驶证归还嗒嗒用车。详情请参考车辆违章处理流程。
.违反交通安全法规时，如现场被告知（比如违反规定停放车辆，被贴条等），应在被告知的7日内接受处罚；如非现场被告知，“嗒嗒用车”可发出书面通知（包括电子邮件、短信等方式）会员交通违章信息，会员收到通知后，应及时参考违章处理流程处理。
.若自通知之日起，用户在7日内还未处理违章，“嗒嗒用车” 将视为用户拒绝处理违章，该行为已构成违约。“嗒嗒用车”有权冻结该用户的平台账户，并从押金中扣除违约金额和违章罚款费用；同时，用户应承担由此给“嗒嗒用车”造成所有的损失，且“嗒嗒用车”保留追究法律责任的权利。
.逾期未消除违章的客户，除承担违章罚款、还应承担车辆停运费150元/天及违章滞纳金150元/天。
事故处理：
.用户在租用“嗒嗒用车”平台车辆期间发生交通事故，须到“嗒嗒用车”指定的维修点修理，在用户有责任的情况下，修理费由用户先行垫付，车辆停驶期间的租金照常计算；用户垫付的费用中所包含的保险公司理赔金额，将会在保险公司赔付款到账后“嗒嗒用车”在30个工作日内返还给用户。
.在用户有责任的情况下，须在事故结案一个月内如实提供事故证明、交通管理部门出具的事故责任认定书、事故调解书、损失清单以及有关修理费用等单据。涉及人员伤亡的，用户应在保险公司规定的期限内提交判决书等相应单据。否则，视为会员自愿放弃索赔权益并承担相关损失。
.在用户有责任的情况下承担一切超出保险公司理赔和/或保险公司拒绝理赔部分的费用，用户该项赔付义务不因各方合作的终止而灭失。若涉及第三方责任，双方应互相协助保险公司追讨应由第三方承担的费用。
.事故处理步骤：
第一步：先检查是否有人员伤亡
如果有人员伤亡，拨打120救援电话，并同时拨打122交警电话明确事故责任，及时拍照留存车辆现场，同时第一时间拨打“嗒嗒用车”平台热线400-6666-589；
第二步：发定位、图片，走保险流程
.拍照留存现场图片，包括事故现场全景图以及车辆损坏的细节图，将微信定位及现场图片一并上传至在线客服；
.交警判定为我方责任，则我方报保险，您需要在第一时间拨打“嗒嗒用车”平台热线获取交强险电话后，自己报保险，并原地等待保险人员到达现场；若交警判定为双方责任，则双方均需报保险；而如果交警判定为对方责任，则对方报保险；
.待保险人员到达现场受理勘察完，将事故认定书案号、交强险单据勘察单、报案短信内容先拍照提供给在线客服，涉及第三方损失的，需一并提供第三方驾驶证行驶证资料，交强险保单资料。
特殊说明
1.若是我方责任，用户必须第一时间报险，否则不计免赔保额1000元的服务将失效。
2.出现事故后，用户请注意人身安全，“嗒嗒用车”为每一款车辆都购买了机动车交通事故责任强制保险，用户需按照“嗒嗒用车”相关部门人员给予的流程操作；若出现逃逸，则需用户承担全部责任。
车辆故障：
.若用户在使用“嗒嗒用车”平台车辆期间，车辆发生故障或低电量无法启动时，请及时开启危险报警闪光灯，做好相关的安全工作后再联系“嗒嗒用车”平台热线获取拖车服务电话。用户自行联系拖车服务提供商，等待相关工作人员到达现场进行拖车。该笔租车订单计费结束时间为用户向“嗒嗒用车”平台的保障时间；
.若由车辆故障造成的拖车，拖车服务费用由“嗒嗒用车”平台承担；若由用户自己原因造成，拖车费用则由用户自行承担，该笔费用将由“嗒嗒用车”平台录入到订单之中。
.在租用车辆期间发生各类机件故障、事故车修复，应当到“嗒嗒用车”平台指定的4S店进行检测及修理。如因用户原因导致损坏，用户应当支付由此造成的修理费用、施救费用及维修期间“嗒嗒用车”平台的营业损失（150元/天）。
.无论用户是否购买不计免赔服务，因用户租赁过程中发生事故（车辆自身故障除外），车辆维修周期超过3天，停运天数按车辆实际维修天数计算，停运损失费按150元/天进行计算。若因违法违规驾驶导致车辆被扣的，停运天数按车辆实际被扣押天数计算，停运损失费按150元/天进行计算。
免责声明
（一）有下列情况之一的，嗒嗒用车不承担任何法律责任：
.由于您将用户密码告知他人或与他人共享注册账号，或由于黑客获取了您的账号和密码而导致的任何个人资料泄露及由此造成的损失；
.任何由于计算机或移动终端的问题、如：黑客攻击、病毒侵入或发作、政府管制等造成的暂时性关闭，使网络无法正常运行而造成的个人资料泄露、丢失、被盗用或被篡改；
.由于与本平台链接的其他网站或平台所造成的个人资料泄露及由此而导致的任何法律争议和后果；
.用户在用车期间，因个人原因需要临时停车或临时离开车辆时，凡现金、重要文件、贵重物品及车内其他用户个人物品请在人员离开车辆时随身携带，出现损坏或丢失被盗情况，用户自行承担损失，“嗒嗒用车”不承担任何赔偿责任。
.用户按照“嗒嗒用车”要求归还车辆后，对于遗落在车辆中的物品“嗒嗒用车”不负保管责任，出现损坏或者丢失，用户自行承担损失，“嗒嗒用车”不承担任何赔偿责任。
.因不可抗力而引起的任何后果。
（二）嗒嗒用车对于任何自本公司平台网站、论坛而获得的他人的信息、内容或者广告宣传等任何资讯（以下统称「信息」），不保证其真实、准确和完整性。如果任何单位或者个人通过上述信息而进行任何行为，须自行甄别真伪和谨慎预防风险。否则，无论何种原因，本公司不对任何非与嗒嗒用车直接发生的交易或行为承担任何直接、间接、附带或衍生的损失和责任。
（三）嗒嗒用车将致力于保护您的个人信息，尽全力保证这些信息的安全。由于网上技术的发展突飞猛进，嗒嗒用车会随时更新信息保密制度，所有的修订将在嗒嗒用车官方渠道公布。
（四） 嗒嗒用车鼓励用户自行按照充电标准为车辆充电，但因客户未按照充电标准为车辆充电导致的人员伤亡、车辆损毁或其他损失均由客户自行承担。
隐私保护
（一）嗒嗒用车的车辆装载有卫星定位系统GPS、行车记录仪以及远程处理系统。嗒嗒用车承诺保护每位用户的隐私。用户同意嗒嗒用车检索并使用车载远程处理装置所记录所有的资料。 嗒嗒用车按隐私政策限制其员工及其他有关方使用用户的个人信息， 防止非公开个人资料遭到非授权散布。
（二）在不透露单个会员隐私资料的前提下， 嗒嗒用车有权对整个会员数据库进行分析并对用户数据库进行商业上的利用，但以下情形除外：
.事先获得用户的明确授权；
.只有透露会员的个人资料，才能提供会员所要求的产品和服务；
.根据有关的法律法规要求；
.按照相关政府主管部门的要求；
.为维护社会公众的利益；
.为维护嗒嗒用车的合法权益。
（三）您一旦注册成功成为用户，将得到一个密码和账号。请您保管好自己的账号和密码安全，未能保管好造成的用户损失将自行承担全部责任。嗒嗒用车也许会因法律要求公开个人资料。
附则
（一）本协议的订立、执行和解释及争议的解决均应适用中国法律；
（二）本协议由福建省嗒嗒用车科技有限公司制定，并拥有最终解释权；
（三）双方就本条款内容或其执行发生任何争议，双方应尽力友好协商解决；协商不成时，任何一方均可向嗒嗒用车总部所在当地的人民法院提起诉讼。
 
            </text>
          </view>
          <view v-else>
            <text class="h1">不计免赔说明</text>
            <text class="p">
嗒嗒用户服务协议

特别声明
嗒嗒用车互联网汽车租赁平台是由福建省嗒嗒用车科技有限公司负责运营。此协议是用户与嗒嗒用车之间关于用户使用嗒嗒用车互联网汽车租赁平台服务所签订的协议。 
定义
「嗒嗒用车」是指福建省嗒嗒用车科技有限公司创建的发布新能源小客车租赁信息、用户获取新能源小客车租赁信息的移动互联网技术服务平台。
「用户」是指嗒嗒用车服务的使用人。
「付费」指用户支付的所有款项，包括里程费，时长费以及服务条款中规定的其他相关费用。
「授权驾驶人」指嗒嗒用车注册用户本人，年满 18 周岁以上，并具有有效驾驶证件。
「使用期间」指从用户确定用车时间到用户将车辆归还至指定车辆还车地点、并按嗒嗒用车要求将车停放妥当并确认还车的期间。
「预定时间」是指用户与嗒嗒用车预先约定的取车时间。
「车辆」指用户预定的嗒嗒用车新能源电动汽车或嗒嗒用车可能提供的任何替换车辆。
「车辆状态」指嗒嗒用车车辆外观、市场价格、组件、配件、系统情况，车辆内外清洁程度等与车辆工作状态相关的情况。
嗒嗒用车在此提醒您认真阅读本协议，充分理解所有条款，特别是免除或限制嗒嗒用车责任的免责条款及对您的权利限制的条款，并选择接受或不接受本协议。除非您接受协议条款，否则您无权使用本协议所涉及的车辆和相关服务。
申明
您确认，在您完成「嗒嗒用车」用户注册之前，已充分阅读、理解并接受本条款的全部内容，注册成功，即表示您同意遵循本条款之所有约定。本协议在您接受注册时生效，将成为您和嗒嗒用车之间具有法律意义的文件，您和嗒嗒用车将同时受到本协议条款的约束。在您注册成功后， 嗒嗒用车将分配给您一个会员账号，您将自行设置密码。此外，该账号和密码由您负责保管；您应当对通过您的会员账号进行的所有活动和事件承担法律责任。
您同意，本公司有权随时对本条款内容进行单方面的变更，并在嗒嗒用车网站或公众号以公告的方式予以公布，无需另行单独通知您；若您在本条款内容公告变更后继续使用本服务，表示您已充分阅读、理解并接受修改后的条款内容，也将遵循修改后的条款内容使用本服务；若您不同意修改后的条款内容，您应停止使用本服务。
您声明，您同意接受本条款并注册成为嗒嗒用车会员。您是具有法律规定的享有完全民事权利能力和民事行为能力，且能够独立承担民事责任的自然人。不具备前述条件的，请您立即停止注册或使用本服务。
注册资格
（一）凡年龄在18周岁（含）以上、持有中华人民共和国有效身份证件（二代身份证、港澳居民来往内地通行证、大陆通行证、护照（限港澳台人士）和中华人民共和国有效驾驶执照（准驾车型为C1或C2（含）以上）可注册。外籍人士暂无法申请。
（二）如果用户的驾照在任何时间被吊销、没收、失效或其状态发生变化，会员必须立即通知嗒嗒用车，且在此期间会员不得使用或预订任何嗒嗒用车服务，否则由此产生的后果／责任均由用户自行承担。
（三）嗒嗒账号的所有权归嗒嗒用车科技有限公司，客户必须使用本人的有效信息完成注册申请手续后，才可获得嗒嗒用车账号的使用权。用户应提供及时、详尽及准确的个人资料，并不断更新注册资料，符合及时、详尽）、准确的要求。输入的资料将作为注册资料由嗒嗒用车负责保存。同时，嗒嗒用车有权就用户所提交资料与信息，通过第三方平台，就其真实性、可靠性及信用等级进行评估。
（四）如果因账户注册信息不真实而引起的一切问题及其产生的后果，嗒嗒用车不负任何责任，嗒嗒用车有权对会员账号进行停封。如对嗒嗒用车造成损失，嗒嗒用车有权追究用户责任及索赔损失。
（五）用户不得将其账号、密码转让或出借予他人使用。借用人和使用人都要承担连带法律责任，嗒嗒用车不承担任何责任。借用账号给他人使用的，嗒嗒用车将提交相关证据至执法部门依法给予罚款，严重者会被吊销驾照。如用户发现其账号遭他人非法使用应立即通知嗒嗒用车。因黑客行为或会员个人的保管疏忽导致账号、密码遭他人非法使用，嗒嗒用车将不承担任何责任。
用户权利及义务
（一）用户享有使用嗒嗒用车产品和服务的权益。
（二）用户使用嗒嗒用车服务期间，享有车辆的使用权，用户承诺其持有中国大陆交管部门核发的并按要求审验的《中华人民共和国机动车驾驶证》。
（三）用户必须如实告知或填写相关信息（包括但不限于身份证件、联系方式等），保证相关证件和信息真实有效，并保证同一证件只允许关联一个账号信息，并且使用车辆期间会员信息所载明的联系方式有效。若出现注册人与用车人信息不对称，则由此产生的后果／责任均由注册人自行承担。
（四）用户自行承担车辆使用中产生的停车费和过路过桥等费用（包含但不限于以上自付费项目或因客户原因而产生的费用），用户需自行负责车上人员及财产的安全。
（五）会员在使用嗒嗒用车服务时应当严格遵守道路交通规则，不得酒后驾驶，并独立承担因交通事故产生的相关责任。
（六）如车辆出现故障或异常，用户应立即通知嗒嗒用车，告知地点后等待嗒嗒用车维修人员，也可将车辆开到嗒嗒用车指定的地点修理。
（七）车辆只能作为自己租赁车辆使用，用户不得将车辆用于营利性运营、竞赛、抵押、测试、实验、教练等活动；不得将车辆用于承载有毒有害及违禁物品；不得将车辆用于从事违法、违规活动。用户不得有转租、转借、抵押、倒卖或其他任何损害车辆所有权和使用权的行为。
（八）用户在使用车辆期间，应保持车辆外观、内饰的整洁、完好。此外，车内禁止携带宠物、海鲜、食醋等会污损内饰及异味较大的物品。在用车期间如产生污损或异味，用户需承担车辆清洁服务费用或其他责任。
（九）用户还车后由于用户个人原因致使车辆牌照、证件、车内清洁布等车内物品丢失，除支付补办相关物品的全部费用外，还应当支付补办相关物品期间给嗒嗒用车造成的营业损失费用，如无故不承担相关费用，相应法律责任由用户承担。
（十）由于因用户自身原因（如：酒驾、误操作、保管不当等）对车辆造成损失，应由用户承担相应及由此带来的一切损失，如无故不承担相关费用，相应法律责任由用户承担；
（十一）用户在使用嗒嗒用车服务期间，取还车时，需按嗒嗒用车图片所示要求拍照，取还车未拍照或未按要求拍照，后果由用户自行承担。
用户违约
（一）提供虚假信息，或盗用他人信息的。
（二）将车辆提供给任何非授权驾驶人驾驶。
（三）任何服用酒精、麻醉品或药物的驾驶人员，无论其是否在医生的指导下使用上述物品。
（四）未按约定使用车辆的。
（五）转卖、抵押、典当、转借、转租或确有证据证明可能存在上述情况的。
（六）不按协议约定交纳租金及各项费用、使用租赁车辆、保管租赁车辆、归还租赁车辆的。
（七）用户利用租赁车辆从事违法犯罪活动的。
（八）擅自改装、拆除、更换、增设车内配备的任何物品。
（九）利用任何方式方法危害「嗒嗒用车」平台安全的。
（十）利用「嗒嗒用车」或其提供的车辆，损害任何第三人合法权益的。
（十一）将车辆行驶到任何没有铺设路面的土路上行驶或越野行驶，「嗒嗒用车」以书面形式批准的除外。
（十二）承载超出车辆核定限乘人数以外的乘客。
（十三）恶意拆除车内配备的任何物品。
（十四）恶意诋毁「嗒嗒用车」的（包括在「嗒嗒用车」平台，以及在其他任何地方）；
（十五）含有法律、行政法规禁止的其他内容。
（十六）嗒嗒用车区域运营车辆只能在该区域行驶，如泉州市运营车辆只能在泉州运营。若用户将车辆行驶至区域外，所造成的损失将由用户承担。车辆禁止行驶及停放到信号弱的场所（如；山区、海边、地下室等）若用户将车辆行驶至信号弱区域所造成的损失将由用户承担。
（十七）用户因为违法违规使用车辆导致车辆被扣押或不能上路，停运之日起需向嗒嗒用车官方账户缴纳日停运损失费。
（十八）用户不得用租赁车辆进行违法活动，不得参加各类竞赛及做测试使用，不得进行营利性质的运输，不得运送易燃、易爆、易腐蚀品，不得在损坏或非正式路面上行驶，不得将承租车辆驶入高速路段，不得驶出租赁起始地所在地级市范围，凡因上述原因造成车辆损坏、车辆事故、人身伤亡或公安部门的扣车、对车主罚款、拖车等发生的一切费用和损失均由用户承担。
（十九）使用车辆还车时未关车辆大灯造成蓄电池耗电，甚至损坏时，取违约费用5元起（蓄电池若损坏则罚款价格参照4S店定损单）；
（二十）使用车辆还车时未关车门取违约费用5元起，未关车窗收取违约费用10元起（若因此造成车辆被破坏、被盗，用户需承担全部责任）；
（二十一）使用车辆还车时未熄火，取违约费用20元起；
（二十二）使用车辆时，因为人为造成车辆内外污垢或异味难除时，收取相应车辆清洗费用20 - 100元起；
（二十三）使用车辆时，影响道路正常通行者，收取违约费用20 - 2000元；
（二十四）使用车辆时，因为人为造成车辆钥匙丢失，收取钥匙丢失违约费用100元；
（二十五）使用车辆时，因为人为破坏车辆车贴，收取车贴违约费用200元；
（二十六）用户禁止租用本公司车辆进行：恶意聚众上访、纠集上访；非法垄断和强占客运路线，暴力抢客源，经常殴打、谩骂驾乘人员和乘客，打砸损毁交通工具的；在高速、普通公路服务区以及公交线路扒窃、抢劫乘客，被发现后实施威胁、殴打、伤害等手段的；私设卡口，以各种名义向过往、停泊的交通工作收取保护费的；画地为牢，强占或非法经营码头、货场，强行提供服务的等涉及黑恶行为。
（二十七）用户具有未结款项或未处理的违章、事故、出险等事项，经确认用户为责任人，经通知后用户拒不按照约定及时处理的，因此造成的诉讼费、律师费、公证费、鉴定费等维权费用需由用户承担。
（二十八）若由用户自身原因造成的拖车，拖车费用则由用户自行承担，拖车费用起步价为150元，超出10公里每公里增加10元，该笔费用将由“嗒嗒用车”平台录入到订单之中。
 
用户若出现上述违约责任情形，将承担因此而造成的全部法律责任和经济赔偿责任，并无权通过保险获得任何可能的补偿。「嗒嗒用车」有权从用户支付的押金中直接进行抵扣，押金全部抵扣后不足以弥补「嗒嗒用车」的经济损失的，「嗒嗒用车」依然有权要求用户承担赔偿责任，用户应在收到「嗒嗒用车」通知后当日立即支付相关费用。
「嗒嗒用车」可在不向用户发出通知的情况下，终止其使用车辆的权利和用户资格。「嗒嗒用车」保留法律规定的权利，包括但不限于不经过法律程序向用户发出通知而扣押车辆，用户有义务支付所有「嗒嗒用车」将车辆追回所发生的费用。
在用户不按照嗒嗒用车要求归还车辆时，「嗒嗒用车」有权利用备用的车辆钥匙将租赁车辆取回；对于车辆中的物品嗒嗒用车有权留置或返还，由此而造成用户损失的，嗒嗒用车不承担任何赔偿责任。如果用户在使用权利终止后继续使用车辆，嗒嗒用车有权通知公安机关车辆被盗并配合公安机关追回车辆。
计费规则和收费项目
实际费用可能因优惠活动、车型不同而调整，最终价格以嗒嗒用车APP结算界面为标准。
.账户余额
嗒嗒用车APP中支持个人账户余额充值，充值方式为用户通过嗒嗒用车认可的在线支付渠道（支付宝、微信）向嗒嗒用车平台充值。当用户为个人账户余额充值时，该账户可用余额不支持退还，请理性充值。在「充值返利」优惠活动中返利的余额以及通过活动获得的余额均不支持退还，禁止以任何方式套现。
.押金
（1）用户可使用嗒嗒用车平台认可的在线支付渠道支付押金，押金金额以用户申请支付押金时嗒嗒用车平台提示的金额为准。嗒嗒用车有权根据用户使用车辆的具体情况调整押金标准，用户应根据嗒嗒用车平台的提示补足押金，否则将无法使用车辆。
（2）押金不等同于用户个人账户的可用余额，不具备订单支付功能，用车订单产生的费用须另行支付。
 （3）租车押金在用户最末次订单待查违章结束后（订单待查违章时间为15—20个工作日），如用户无违章扣款、无逾期未支付的费用或其他违约行为可申请退还，该押金将退还原支付账户（即支付租车押金时使用的账户），如遇特殊情况无法退还原账户的，将退还至用户提供的其他账户，退还时间为自申请之日起1—7个工作日，如遇节假日等特殊情况时间顺延。押金存入“嗒嗒用车”平台中产生的孳息归“嗒嗒用车”所有，押金退还为无息退还。
（4）用户账户有效期间，若用户存在逾期未缴纳租金、服务费、违章且未缴纳相关罚款、违约金，或违反本协议项下任何义务等行为，“嗒嗒用车”有权根据本协议相关规定按以下顺序冻结或扣除租车押金、申请支付宝代扣或刷取的预授权，抵扣包括但不限于本协议项下已经发生且逾期仍未支付的相关费用，且抵扣顺序如下：①租金、其他服务费等订单费用；②逾期未支付订单费用；③逾期处理违章违约金；④其他违约金；⑤车辆损失、损坏（包括存在破损、剐蹭，内外机件、部件、饰件、设备存在损坏、缺失、脏污，车辆无法正常启动等情形）等产生的维修费用；⑥其他应付费用；⑦给“嗒嗒用车”和/或第三方主体造成的其他所有损失，不足部分用户应根据“嗒嗒用车”要求及时补足。在用户租车押金不足本协议规定的情况下，“嗒嗒用车”有权拒绝提供租车服务，待用户补足相应押金数额后方可继续用车。
    
.预授权（芝麻信用免押）
（1）用户使用车辆前应向“ 嗒嗒用车 ”支付租车押金，用户本人“芝麻信用”通过认证，享受免押金待遇。
（2）当车辆发生损坏、违章以及发生行政处罚而产生费用后，用户不按约定承担相应责任，“嗒嗒用车”有权从租车押金中直接抵扣相应费用，抵扣不足部分，“嗒嗒用车”有权继续向用户追缴。
（3）用户不再使用“嗒嗒用车”平台租用车辆时：芝麻信用免押金的用户，可向“嗒嗒用车”申请解除免押授权，在最后一个订单结束后的第45个自然日起，可以在APP中点击申请解除授权，“嗒嗒用车”将在确认用户所有违章均已处理且所有违约及赔偿责任均已承担后的1个工作日内，为用户解除免押授权。
（4）芝麻信用分≥650分，身份证和驾驶证审核通过，无不良用车记录，即可在APP操作申请免押金。免押金操作方法：前往「个人中心」-「我的押金」-「芝麻免押」-「同意开启」申请“嗒嗒用车”免押金用车。
（5）在授权275个自然日之后，用户需在APP重新进行免押授权操作。重新授权操作步骤：结清所有未结算的费用—APP取消授权—再次同意开启免押授权。重新进行免押授权前，用户请确保所有费用已结清，否则无法重新开启。用户不再用车，在超过最后1笔订单的30个自然日后：若用户已结清费用，“ 嗒嗒用车 ”将为用户取消免押授权；若用户存在未结算费用的，经通知后，用户仍未按照约定及时支付相应费用且用户确认相关费用金额，“ 嗒嗒用车 ”有权通过支付宝信用代扣服务相应扣除，并为用户取消免押授权。
.不计免赔
在使用车辆过程中，因用户自身原因，对“嗒嗒用车”车辆造成损伤，用户本应承担对“嗒嗒用车”的赔偿费用；购买不计免赔服务后，在一定额度范围内，对用户驾龄小于2年情形的，由用户承担该赔偿费用的30%；对用户驾龄大于等于2年情形的，用户需承担该赔偿费用的15%；超出前述额度部分的，用户需自行承担赔偿费用。
不计免赔服务不等于保险，保障范围不包括保险。若车辆出现事故，动用到保险，客户需缴纳次年保险递增费用1000元/次（费用将记录在该客户APP订单中）。
注：如因不购买不计免赔服务出事故者，需承担车辆的全部损失费用（包括但不限于车辆维修费、停运损失费等）。
不计免赔服务保障范围：
.用户在车辆使用期间发生事故，因此导致车辆无法上线运营时，用户本需缴纳的150元/天的车辆停运损失费，在1000元以内可抵扣。超出1000元，所产生的停运费用，客户按实际停运天数赔偿，即150元/天。
.在使用车辆过程中，因用户自身原因，对“嗒嗒用车”车辆造成损伤，用户本应承担对“嗒嗒用车”的赔偿费用；购买不计免赔服务后，在一定额度范围内，对用户驾龄小于2年情形的，由用户承担该赔偿费用的30%；对用户驾龄大于等于2年情形的，用户需承担该赔偿费用的15%；超出前述额度部分的，用户需自行承担赔偿费用。
以下情况，不计免赔服务无法保障：
.因用户自身原因，对车辆造成损伤需要维修，用户本应承担对“嗒嗒用车”的赔偿费用；购买不计免赔服务后，在一定额度范围内，对用户驾龄小于2年情形的，由用户承担该赔偿费用的30%；对用户驾龄大于等于2年情形的，用户需承担该赔偿费用的15%；超出前述额度部分，用户需自行承担赔偿费用。（包括但不限于由此引起的车辆停运损失费）；
.车辆轮胎出现破损漏气等问题，用户未等修复，强行继续行驶，而导致轮胎报废或轮毂损坏的费用；
.车辆破损、变形、报废部分，涉及需要重新更换配件的费用；
.车内配套物品，用户损坏或丢失应按原价赔偿；
.保险理赔范围外的（包括但不限于酒驾、逃逸等）和因用户原因造成无法申报保险的；
.注：用户在车辆使用期间发生事故，如用户未能立即向“嗒嗒用车”报告事故及配合事故调查、解决工作，则购买的不计免赔服务失效，会员应承担全部损失责任和费用。
其他收费：
.如有车辆遇事故，用户须第一时间联系客服电话【400-6666-589】获取保险电话（若客服联系不上，可直接致电110或122报警。）如果没有当场报险，用户需承担全部责任及其他维修费用。
.不计免赔服务的免赔范围不包括保险。若车辆事故动用保险，客户必须缴纳次年保险递增费用1000元/次（费用将记录在该客户APP订单中）。
.如果不购买不计免赔服务出事故者，需承担车辆的全部损失费用；
.停运损失费以及保险理赔范围外的（如酒驾、逃逸等）和因客户原因造成无法申报保险的不包含在内。
.若用户在使用车辆时造成车内存在明显垃圾或异味，嗒嗒用车有权向对方收取30-200元清洁服务费。
.违规费用：预订用户将车辆交予非授权驾驶人驾驶，将被收取1000元违约金。
.用户未将汽车归还到指定还车网点，将被收取送车服务费用100元起，预约异地还车服务的除外。
.由于用户在车辆熄火时未关闭灯光，收音机等耗电部件，以致车辆电量耗尽无法再次正常行驶，嗒嗒用车将为车辆实行有偿紧急抢救。用户将被收取20元-100元的蓄电池抢救费，以及蓄电池损耗费50元。
.用户还车后未检查车辆电源、车门、车窗是否关闭，如未造成车辆严重后果的将被收取违约费用10元-100元，如造成车辆丢失，用户承担全部责任。
.用户未遵守交通法规将车辆停放在交通要道且私自离开（包含车辆故障等情况）造成交通拥堵或者其他影响道路正常通行的后果，用户需承担违规所造成的全部经济及法律责任，同时我司将视违规情况轻重收取300元-1000元罚款。
整备服务费：
.如有时指会员使用分时租赁、日租、月租产品时提供的整备服务所收取的费用。
包含用车期间轮胎单独损坏，免于承担轮胎补胎加气（不含现场救援费用），但不免除轮胎损坏后继续行驶造成的其他车辆损失。另外，不包含因用户原因造成轮胎损坏而产生的事故责任。
包含车内垃圾遗留、车身外观污渍时免于承担清洁费用。
取车、还车说明
取车说明：
.当您使用「分时」服务时，在嗒嗒用车APP下单后，15分钟内免费取消订单。超过15分钟或15分钟内进行「开门」操作订单便会按下单时间开始计费。所以您在用车前务必检查车辆是否正常，若发现故障问题，请第一时间联系到嗒嗒用车客服并说明故障情况。当您使用各类优惠套餐时，套餐时间一旦开始便无法取消订单，不支持退款，不支持使用优惠券，不支持更换套餐。
.取车时，用户应当确认车辆及附属品的实际状况，如有疑问请拍照车辆车牌和输入文字发送至嗒嗒用车微信公众号。如取车时未及时上报车辆情况而导致后续车辆损失追责的，用户应当承担相应责任。
.嗒嗒用车取车网点均是付费合作网点，用户取车遇到收费，请提前联系客服处理，擅自缴纳停车费的，一律不予退款。
还车说明：
.用车时，应注意北汽EC系列、江淮iev4车型、奇瑞EQ1车型续航里程必须保证高于30KM、帝豪EV系列和江淮iev7S车型续航里程必须保证高于50KM，当北汽EC系列、江淮iev4车型、奇瑞EQ1车型续航里程还车续航里程不足30km时，帝豪EV系列和江淮iev7S车型续航里程不足50km时，将收取200元/次电池损耗费。或因车辆电量不足，而产生的拖车费用，用户需自行承担。
.还车时，用户应将车辆开至嗒嗒用车指定服务网点位置，还车时间以用户实际操作完成还车流程的时间为准，确认所有订单完成后终止合同。
.车辆，连同其钥匙（如：北汽EC系列、江淮iEV6e）和所有的附属物品，包括行驶本，清洁布等）必须一并归还，并且要保持和使用开始前一致的状况，如发生丢失或损坏需照价赔偿相应产生的停运损失费及其他费用需一并赔偿。
.用户应在归还车辆时，确保车内无任何个人财物。如还车时，有任何用户的个人财物落在车中，所产生的相应责任由用户个人承担， 嗒嗒用车不承担任何责任。
未按约定还车说明：
.用户结束订单时，应将车辆归还至嗒嗒用车指定服务网点位置，并确认车辆车灯、门窗关闭，查看无误后在APP操作还车。
.如用户还车时，未将车辆停放至停车位，由此给嗒嗒用车造成的一切损失由用户承担，同时嗒嗒用车有权追究用户的法律责任，并有权取消违约用户的资质。
.用户归还车辆时车内未保持清洁，嗒嗒用车有权收取清洁服务费10-100元；若车身严重肮脏（如泥巴等）需要进行专业清洗的按实际产生费用收取费用。
.还车时，用户应将车辆开至嗒嗒用车指定服务网点位置，未按指定服务网点还车产生的拖车费及调度费由用户承担。
 
 
保险、事故与损失赔偿
声明：
.”嗒嗒用车“平台上运营的车辆，皆已投保了交通责任强制险未投保商业险责任险。
.用户在车辆使用期间发生任何事故，无论所处环境或严重程度如何，应立即联系”嗒嗒用车“客服人员，对于在汽车使用期间发生的强制保险理赔的调查和解决，用户有责任全力配合“嗒嗒用车”或其保险公司的工作。如用户未能立即报告事故和配合事故调查，解决工作，则购买的不计免赔服务失效，会员应承担“嗒嗒用车”平台全部损失的责任和费用。
.若为强制险保险责任以外的原因造成的事故损失以及强制险保险不能赔偿的事故损失，由用户全额承担。
.本协议将据平台和市场价格更新。“嗒嗒用车”会对不计免赔服务、赔偿收费标准、保险理赔方式进行动态调整，具体内容详情以用户下单时APP展示的协议为准
损失赔偿：
.用户在使用车辆期间，发生事故，需动用到保险赔付的，用户需承担30%的车辆损失折旧费，以及1000元的保险递增费。
.事故损失金额以保险公司定损单或4S店修理清单为准。小额损失可按简易流程定损，具体定损标准为：
.外观：外观覆盖件为前保险杠、后保险杠、车门、发动机盖、后备厢盖各为一个板块，刮擦定损为每个板块为400元。
.钣金：如外观覆盖件需钣金修复的，按每平方米400元计价。
.轮胎：如轮胎破损严重做报废处理的，按单个400元的全新购置费用计价。
.轮毂：如果轮毂破损情况严重，如变形、裂缝。按一套轮胎轮毂800元计价。
.脚垫：前座每块50元/块，后座80元/块，后备箱垫80元/块。
.清洁费：因人为造成车辆内外污垢涂抹或异味难除，将收取相应车辆清洗费用。
违章及代办说明：
.用户使用服务期内的违章及相关费用等责任由用户自行承担，“嗒嗒用车”将短信或电话通知用户使用服务期内的车辆违章，用户也可在APP的违章查询功能进行查询。用户接到违章通知起的7天内，联系嗒嗒用车微信公众号客服，咨询违章车辆行驶证是否出借，再携带身份证到嗒嗒用车办事处录入违章信息，然后携带“嗒嗒用车”平台提供的车辆行驶证原件及委托书前往交警队处理，处理后将行驶证归还嗒嗒用车。详情请参考车辆违章处理流程。
.违反交通安全法规时，如现场被告知（比如违反规定停放车辆，被贴条等），应在被告知的7日内接受处罚；如非现场被告知，“嗒嗒用车”可发出书面通知（包括电子邮件、短信等方式）会员交通违章信息，会员收到通知后，应及时参考违章处理流程处理。
.若自通知之日起，用户在7日内还未处理违章，“嗒嗒用车” 将视为用户拒绝处理违章，该行为已构成违约。“嗒嗒用车”有权冻结该用户的平台账户，并从押金中扣除违约金额和违章罚款费用；同时，用户应承担由此给“嗒嗒用车”造成所有的损失，且“嗒嗒用车”保留追究法律责任的权利。
.逾期未消除违章的客户，除承担违章罚款、还应承担车辆停运费150元/天及违章滞纳金150元/天。
事故处理：
.用户在租用“嗒嗒用车”平台车辆期间发生交通事故，须到“嗒嗒用车”指定的维修点修理，在用户有责任的情况下，修理费由用户先行垫付，车辆停驶期间的租金照常计算；用户垫付的费用中所包含的保险公司理赔金额，将会在保险公司赔付款到账后“嗒嗒用车”在30个工作日内返还给用户。
.在用户有责任的情况下，须在事故结案一个月内如实提供事故证明、交通管理部门出具的事故责任认定书、事故调解书、损失清单以及有关修理费用等单据。涉及人员伤亡的，用户应在保险公司规定的期限内提交判决书等相应单据。否则，视为会员自愿放弃索赔权益并承担相关损失。
.在用户有责任的情况下承担一切超出保险公司理赔和/或保险公司拒绝理赔部分的费用，用户该项赔付义务不因各方合作的终止而灭失。若涉及第三方责任，双方应互相协助保险公司追讨应由第三方承担的费用。
.事故处理步骤：
第一步：先检查是否有人员伤亡
如果有人员伤亡，拨打120救援电话，并同时拨打122交警电话明确事故责任，及时拍照留存车辆现场，同时第一时间拨打“嗒嗒用车”平台热线400-6666-589；
第二步：发定位、图片，走保险流程
.拍照留存现场图片，包括事故现场全景图以及车辆损坏的细节图，将微信定位及现场图片一并上传至在线客服；
.交警判定为我方责任，则我方报保险，您需要在第一时间拨打“嗒嗒用车”平台热线获取交强险电话后，自己报保险，并原地等待保险人员到达现场；若交警判定为双方责任，则双方均需报保险；而如果交警判定为对方责任，则对方报保险；
.待保险人员到达现场受理勘察完，将事故认定书案号、交强险单据勘察单、报案短信内容先拍照提供给在线客服，涉及第三方损失的，需一并提供第三方驾驶证行驶证资料，交强险保单资料。
特殊说明
1.若是我方责任，用户必须第一时间报险，否则不计免赔保额1000元的服务将失效。
2.出现事故后，用户请注意人身安全，“嗒嗒用车”为每一款车辆都购买了机动车交通事故责任强制保险，用户需按照“嗒嗒用车”相关部门人员给予的流程操作；若出现逃逸，则需用户承担全部责任。
车辆故障：
.若用户在使用“嗒嗒用车”平台车辆期间，车辆发生故障或低电量无法启动时，请及时开启危险报警闪光灯，做好相关的安全工作后再联系“嗒嗒用车”平台热线获取拖车服务电话。用户自行联系拖车服务提供商，等待相关工作人员到达现场进行拖车。该笔租车订单计费结束时间为用户向“嗒嗒用车”平台的保障时间；
.若由车辆故障造成的拖车，拖车服务费用由“嗒嗒用车”平台承担；若由用户自己原因造成，拖车费用则由用户自行承担，该笔费用将由“嗒嗒用车”平台录入到订单之中。
.在租用车辆期间发生各类机件故障、事故车修复，应当到“嗒嗒用车”平台指定的4S店进行检测及修理。如因用户原因导致损坏，用户应当支付由此造成的修理费用、施救费用及维修期间“嗒嗒用车”平台的营业损失（150元/天）。
.无论用户是否购买不计免赔服务，因用户租赁过程中发生事故（车辆自身故障除外），车辆维修周期超过3天，停运天数按车辆实际维修天数计算，停运损失费按150元/天进行计算。若因违法违规驾驶导致车辆被扣的，停运天数按车辆实际被扣押天数计算，停运损失费按150元/天进行计算。
免责声明
（一）有下列情况之一的，嗒嗒用车不承担任何法律责任：
.由于您将用户密码告知他人或与他人共享注册账号，或由于黑客获取了您的账号和密码而导致的任何个人资料泄露及由此造成的损失；
.任何由于计算机或移动终端的问题、如：黑客攻击、病毒侵入或发作、政府管制等造成的暂时性关闭，使网络无法正常运行而造成的个人资料泄露、丢失、被盗用或被篡改；
.由于与本平台链接的其他网站或平台所造成的个人资料泄露及由此而导致的任何法律争议和后果；
.用户在用车期间，因个人原因需要临时停车或临时离开车辆时，凡现金、重要文件、贵重物品及车内其他用户个人物品请在人员离开车辆时随身携带，出现损坏或丢失被盗情况，用户自行承担损失，“嗒嗒用车”不承担任何赔偿责任。
.用户按照“嗒嗒用车”要求归还车辆后，对于遗落在车辆中的物品“嗒嗒用车”不负保管责任，出现损坏或者丢失，用户自行承担损失，“嗒嗒用车”不承担任何赔偿责任。
.因不可抗力而引起的任何后果。
（二）嗒嗒用车对于任何自本公司平台网站、论坛而获得的他人的信息、内容或者广告宣传等任何资讯（以下统称「信息」），不保证其真实、准确和完整性。如果任何单位或者个人通过上述信息而进行任何行为，须自行甄别真伪和谨慎预防风险。否则，无论何种原因，本公司不对任何非与嗒嗒用车直接发生的交易或行为承担任何直接、间接、附带或衍生的损失和责任。
（三）嗒嗒用车将致力于保护您的个人信息，尽全力保证这些信息的安全。由于网上技术的发展突飞猛进，嗒嗒用车会随时更新信息保密制度，所有的修订将在嗒嗒用车官方渠道公布。
（四） 嗒嗒用车鼓励用户自行按照充电标准为车辆充电，但因客户未按照充电标准为车辆充电导致的人员伤亡、车辆损毁或其他损失均由客户自行承担。
隐私保护
（一）嗒嗒用车的车辆装载有卫星定位系统GPS、行车记录仪以及远程处理系统。嗒嗒用车承诺保护每位用户的隐私。用户同意嗒嗒用车检索并使用车载远程处理装置所记录所有的资料。 嗒嗒用车按隐私政策限制其员工及其他有关方使用用户的个人信息， 防止非公开个人资料遭到非授权散布。
（二）在不透露单个会员隐私资料的前提下， 嗒嗒用车有权对整个会员数据库进行分析并对用户数据库进行商业上的利用，但以下情形除外：
.事先获得用户的明确授权；
.只有透露会员的个人资料，才能提供会员所要求的产品和服务；
.根据有关的法律法规要求；
.按照相关政府主管部门的要求；
.为维护社会公众的利益；
.为维护嗒嗒用车的合法权益。
（三）您一旦注册成功成为用户，将得到一个密码和账号。请您保管好自己的账号和密码安全，未能保管好造成的用户损失将自行承担全部责任。嗒嗒用车也许会因法律要求公开个人资料。
附则
（一）本协议的订立、执行和解释及争议的解决均应适用中国法律；
（二）本协议由福建省嗒嗒用车科技有限公司制定，并拥有最终解释权；
（三）双方就本条款内容或其执行发生任何争议，双方应尽力友好协商解决；协商不成时，任何一方均可向嗒嗒用车总部所在当地的人民法院提起诉讼。
 
            </text>
          </view>
        </view>
      </scroll-view>

      <!-- 签名：步骤3 -->
      <view v-else class="sign-wrap">
        <text class="sign-title">请用正楷签署：{{ realName }}</text>

        <!-- 画板：H5/小程序两端自适配 -->
        <canvas
          class="sign-board"
          :id="canvasId"
          :canvas-id="canvasId"
          type="2d"
          ref="h5Canvas"
          @touchstart="onStart"
          @touchmove="onMove"
          @touchend="onEnd"
          @mousedown="onMouseDown"
          @mousemove="onMouseMove"
          @mouseup="onMouseUp"
          @mouseleave="onMouseUp"
        />

        <!-- 输入校验姓名 -->
        <view class="name-check">
          <input
            class="ipt"
            type="text"
            v-model.trim="nameInput"
            :placeholder="`请再次输入姓名以校验（须与 ${realName} 一致）`"
            confirm-type="done"
          />
          <text v-if="nameError" class="err">{{ nameError }}</text>
        </view>

        <view class="sign-tips">
          <text>签名须分字书写、尽量一字多笔，避免“一笔带过”。</text>
          <text v-if="segWarn" class="warn">笔画过少，疑似草签，请分字书写正楷。</text>
        </view>

        <!-- 工具 -->
        <view class="sign-tools">
          <button class="btn ghost" @tap="clear">清除</button>
          <button class="btn main" :disabled="canSubmitSign" @tap="ok">确定</button>
        </view>
      </view>

      <!-- 底部按钮（步骤1/2） -->
      <view class="afs-actions" v-if="step<=2">
        <button
          class="btn main"
          :class="{ disabled: !canProceed }"
          :disabled="!canProceed"
          @tap="next"
        >
          {{ proceedText }}
        </button>
      </view>
    </view>
  </view>
</template>

<script setup>
import { ref, watch, onMounted, onUnmounted, nextTick, computed } from 'vue'

/** Props & Emits */
const props = defineProps({
  visible: { type: Boolean, default: false },
  realName: { type: String, required: true ,default:'超酷的'},
  readCountdownSec: { type: Number, default: 3 }
})
const emit = defineEmits(['close','finished'])

/** Steps & UI */
const step = ref(1)
const canvasId = 'signBoard'
const hasRead = ref({ 1: false, 2: false })
const countdown = ref(0)
const proceedText = ref('我已阅读')
const scrollTop = ref(0)
let countdownTimer = null

watch(() => props.visible, (v) => {
  if (v) initAll()
  else cleanup()
})

function initAll(){
  step.value = 1
  hasRead.value = { 1: false, 2: false }
  clearCountdown()
  updateProceedBtn()
  resetSignState()
  scrollTop.value = 0
}
function cleanup(){ clearCountdown() }
function clearCountdown(){
  if (countdownTimer){ clearInterval(countdownTimer); countdownTimer = null }
  countdown.value = 0
  updateProceedBtn()
}
function startCountdown(){
  clearCountdown()
  countdown.value = props.readCountdownSec
  updateProceedBtn()
  countdownTimer = setInterval(() => {
    countdown.value--
    updateProceedBtn()
    if (countdown.value<=0) clearCountdown()
  }, 1000)
}
function updateProceedBtn(){
  if (step.value>=3) return
  const ok = hasRead.value[step.value] && countdown.value===0
  proceedText.value = ok ? '我已阅读' : (
    !hasRead.value[step.value]
      ? '请先滚动至文末'
      : `我已阅读（${countdown.value}s）`
  )
}

/** Scroll / Read detection */
function onScroll(e){
  const clientH = e?.target?.offsetHeight || 0
  const total = e.detail?.scrollHeight || 0
  const top = e.detail?.scrollTop || 0
  const bottomGap = total - (top + clientH)
  if (bottomGap <= 10) onToLower()
}
function onToLower(){
  if (!hasRead.value[step.value]){
    hasRead.value[step.value] = true
    startCountdown()
    updateProceedBtn()
  }
}
const canProceed = computed(() => hasRead.value[step.value] && countdown.value===0)
function next(){
  step.value = Math.min(3, step.value + 1)
  if (step.value<=2){
    // 关键：切步时复位滚动状态
    scrollTop.value = 0
    clearCountdown()
    updateProceedBtn()
  }else{
    nextTick(() => initCanvas())
  }
}

/** Canvas 签名（双端适配） */
const h5Canvas = ref(null)
let ctx = null          // H5: CanvasRenderingContext2D；小程序：CanvasContext
let dpr = 1
const IS_H5 = (() => { try { return typeof window !== 'undefined' } catch { return false } })()

const hasStroke = ref(false)
const last = { x: 0, y: 0, drawing: false }
const segCount = ref(0)
const segWarn = ref(false)
const nameInput = ref('')
const nameError = ref('')

const MIN_SEGMENTS_FACTOR = 1
const LINE_WIDTH = 4

function resetSignState(){
  hasStroke.value = false
  segCount.value = 0
  segWarn.value = false
  nameInput.value = ''
  nameError.value = ''
}

function initCanvas(){
  try{
    if (IS_H5){
      // H5：用原生 2D 上下文，并做 DPR 适配
      const c = h5Canvas.value
      if (!c) return
      const rect = c.getBoundingClientRect()
      dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1))
      c.width = Math.floor(rect.width * dpr)
      c.height = Math.floor(rect.height * dpr)
      ctx = c.getContext('2d')
      ctx.scale(dpr, dpr)
      ctx.lineWidth = LINE_WIDTH
      ctx.lineCap = 'round'
      ctx.lineJoin = 'round'
      ctx.strokeStyle = '#FF3B30'
      // 背景白（导出更好看）
      ctx.fillStyle = '#FFFFFF'
      ctx.fillRect(0, 0, rect.width, rect.height)
    }else{
      // 小程序：走 uni.createCanvasContext
      ctx = uni.createCanvasContext(canvasId)
      ctx.setFillStyle('#FFFFFF'); ctx.fillRect(0,0,702,700)
      ctx.setStrokeStyle('#FF3B30')
      ctx.setLineWidth(LINE_WIDTH)
      ctx.setLineCap('round')
      ctx.setLineJoin('round')
      ctx.draw(false)
    }
  }catch(e){
    // 忽略
  }
}

function getPos(e){
  // 兼容 touch 与 mouse
  const t = (e.touches && e.touches[0]) || (e.changedTouches && e.changedTouches[0]) || e
  const x = t?.offsetX ?? t?.x ?? t?.pageX ?? 0
  const y = t?.offsetY ?? t?.y ?? t?.pageY ?? 0
  return { x, y }
}

function beginPath(x, y){
  if (!ctx) return
  if (IS_H5){
    ctx.beginPath()
    ctx.moveTo(x, y)
  }else{
    ctx.beginPath && ctx.beginPath()
    ctx.moveTo && ctx.moveTo(x, y)
  }
}
function drawLineTo(x, y){
  if (!ctx) return
  ctx.lineTo(x, y)
  ctx.stroke()
  if (!IS_H5 && ctx.draw) ctx.draw(true) // 小程序端需要
}

function onStart(e){
  const p = getPos(e)
  last.x = p.x; last.y = p.y; last.drawing = true
  beginPath(p.x, p.y)
}
function onMove(e){
  if (!last.drawing || !ctx) return
  const p = getPos(e)
  drawLineTo(p.x, p.y)
  hasStroke.value = true
  last.x = p.x; last.y = p.y
}
function onEnd(){
  if (!last.drawing) return
  last.drawing = false
  segCount.value++
  const needSeg = Math.max(props.realName?.length || 0, 1) * MIN_SEGMENTS_FACTOR
  segWarn.value = segCount.value < needSeg && hasStroke.value
}

/* 鼠标事件（H5） */
function onMouseDown(e){ if (!IS_H5) return; onStart(e) }
function onMouseMove(e){ if (!IS_H5) return; onMove(e) }
function onMouseUp(e){ if (!IS_H5) return; onEnd(e) }

function clear(){
  resetSignState()
  if (!ctx){ initCanvas(); return }
  if (IS_H5){
    const c = h5Canvas.value
    const rect = c.getBoundingClientRect()
    ctx.clearRect(0,0,rect.width,rect.height)
    ctx.fillStyle = '#FFFFFF'
    ctx.fillRect(0,0,rect.width,rect.height)
    ctx.strokeStyle = '#FF3B30'
    ctx.lineWidth = LINE_WIDTH
  }else{
    ctx.clearRect && ctx.clearRect(0,0,10000,10000)
    ctx.draw && ctx.draw(false)
    ctx.setStrokeStyle && ctx.setStrokeStyle('#FF3B30')
    ctx.setLineWidth && ctx.setLineWidth(LINE_WIDTH)
    ctx.setLineCap && ctx.setLineCap('round')
    ctx.setLineJoin && ctx.setLineJoin('round')
  }
}

const canSubmitSign = computed(() => {
  const nameOk = nameInput.value && nameInput.value === props.realName
  const segOk = segCount.value >= Math.max(props.realName?.length || 0, 1) * MIN_SEGMENTS_FACTOR
  return hasStroke.value && nameOk && segOk
})

async function ok(){
	
	//测试
	  // 👉 临时放行：直接 emit，不校验签名
	  emit('finished', { signPath: '', name: props.realName })
	//测试
	
  if (!nameInput.value){
    nameError.value = '请先输入您的姓名以校验'
    return
  }
  if (nameInput.value !== props.realName){
    nameError.value = '与实名认证姓名不一致，请重试'
    return
  }
  nameError.value = ''

  const needSeg = Math.max(props.realName?.length || 0, 1) * MIN_SEGMENTS_FACTOR
  if (segCount.value < needSeg){
    segWarn.value = true
    uni.showToast({ title: '签名疑似草写，请分字正楷签名', icon: 'none' })
    return
  }
  if (!hasStroke.value){ uni.showToast({ title:'请先签名', icon:'none' }); return }

  // 导出
  try{
    if (IS_H5){
      const c = h5Canvas.value
      const dataURL = c.toDataURL('image/png', 1)
      emit('finished', { signPath: dataURL, name: nameInput.value }) // H5 直接给 base64
    }else{
      uni.canvasToTempFilePath({
        canvasId,
        fileType: 'png',
        quality: 1,
        success: res => emit('finished', { signPath: res.tempFilePath, name: nameInput.value }),
        fail: () => emit('finished', { signPath: '', name: nameInput.value })
      })
    }
  }catch(e){
    emit('finished', { signPath: '', name: nameInput.value })
  }
}

onUnmounted(cleanup)
onMounted(() => { if (props.visible) initAll() })
</script>

<style scoped>
.afs-mask{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:flex; align-items:flex-end; z-index:9999; }
.afs-panel{ width:750rpx; max-height:86vh; background:#fff; border-radius:32rpx 32rpx 0 0; overflow:hidden; }

.afs-steps{ position:relative; display:flex; gap:16rpx; align-items:center; padding:20rpx 24rpx; border-bottom:2rpx solid #eee; }
.s{ font-size:28rpx; color:#999; }
.s.on{ color:#333; font-weight:600; }
.x{ position:absolute; right:24rpx; top:20rpx; font-size:36rpx; color:#666; }

.afs-body{ max-height:50vh; }
.doc{ padding:24rpx; color:#333; }
.h1{ display:block; font-size:34rpx; font-weight:600; margin-bottom:12rpx; }
.p{ display:block; font-size:28rpx; line-height:44rpx; color:#555; }

.sign-wrap{ padding:24rpx; }
.sign-title{ display:block; text-align:center; font-size:36rpx; font-weight:600; color:#222; margin-bottom:16rpx; }
.sign-board{ width:702rpx; height:700rpx; background:#fff; border:2rpx dashed #ddd; border-radius:12rpx; }

.name-check{ margin-top:18rpx; }
.ipt{ width:100%; height:88rpx; border:2rpx solid #e5e5e5; border-radius:12rpx; padding:0 20rpx; font-size:32rpx; }
.err{ display:block; margin-top:8rpx; color:#ff3b30; font-size:26rpx; }

.sign-tips{ margin-top:10rpx; color:#888; font-size:26rpx; display:flex; flex-direction:column; gap:6rpx; }
.warn{ color:#ff9500; }

.sign-tools{ margin-top:16rpx; display:flex; justify-content:space-between; gap:16rpx; }
.btn{ flex:1; height:90rpx; border-radius:54rpx; font-size:34rpx; display:flex; align-items:center; justify-content:center; }
.btn.ghost{ background:#f5f5f5; color:#333; }
.btn.main{ background:#1BBD43; color:#fff; }
.btn.main:disabled, .btn.disabled{ opacity:.45; }

.afs-actions{ padding:16rpx 24rpx 28rpx; }
</style>
